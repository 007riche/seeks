<!DOCTYPE HTML>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>qclean - Seeks Search</title>
<link rel="search" href="opensearch.xml" type="application/opensearchdescription+xml" title="Seeks Search" />
<link rel="stylesheet" href="@base-url@/public/yui/3.0.0/cssreset/reset-min.css" type="text/css" />
<link rel="stylesheet" href="@base-url@/public/yui/3.0.0/cssfonts/fonts-min.css" type="text/css" />
<link rel="stylesheet" href="@base-url@/public/yui/3.0.0/cssgrids/grids-min.css" type="text/css" />
<link rel="stylesheet" href="@base-url@/public/css/base.css" type="text/css" />
<link rel="stylesheet" href="seeks_search.css" type="text/css" />
<link rel="shortcut icon" type="image/png" href="/public/images/seek_icon_32x32_transparent.png" />
</head>

<body>

#include info-head

<div id="search_bar">
<form method="GET" action="@base-url@/search" id="search_form" onsubmit="return false;">
<input title="Search (ctrl+f)" id="search_input" autocomplete="off" name="q" maxlength="2048" value="qclean" type="text" />
<input name="qknown" value="fullquery" type="hidden" />
<input name="expansion" value="1" type="hidden" />
<input name="action" value="expand" type="hidden" />
<!-- <input name="engines" value="xxeng" type="hidden" /> -->
<input name="content_analysis" value="xxca" type="hidden" />
<input name="ui" value="dyn" type="hidden" />
<input name="output" value="json" type="hidden" />
<input id="search_button" value="" type="submit" />
</form>

<!-- <a href="@base-url@/search?q=fullquery&amp;page=xxpage&amp;expansion=xxexpn&amp;action=expand&amp;engines=xxeng&amp;rpp=xxrpp&amp;content_analysis=xxca&amp;prs=xxpers" title="Expand to xxexpn (ctrl+e). Deeper search." id="expansion" class="expansion_xxexp">xxexp</a> -->

<p id="expand"></p>

<!-- @if-have-clustering-start -->
<a href="@base-url@/search?q=fullquery&amp;expansion=xxexp&amp;action=clusterize&amp;clusters=xxnclust&amp;engines=xxeng&amp;rpp=xxrpp&amp;content_analysis=xxcca&amp;prs=xxpers" title="Cluster (ctrl+c)" id="cluster" class="cluster_off">&nbsp;</a>
<!-- if-have-clustering-end@ -->
<!-- @if-not-have-clustering-start -->
<a href="" title="Cluster (not activated by this node)" id="cluster" class="cluster_inactive">&nbsp;</a>
<!-- if-not-have-clustering-end@ -->

<!-- @if-have-one-column-results-head-start -->
<!-- <div id="search_pages">xxprev<span id="search_page_current">xxpage</span>xxnext<small>page</small></div> -->
<div id="search_pages"></div>
<!-- if-have-one-column-results-head-end@ -->
<!-- @if-have-clustered-results-head-start -->
<!-- <div id="search_pages"><a href="@base-url@/search?q=fullquery&amp;page=xxpage&amp;expansion=xxexp&amp;action=expand&amp;engines=xxeng&amp;rpp=xxrpp&amp;content_analysis=xxca&amp;prs=xxpers" id="search_page_prev" title="Back to list of results">&nbsp;</a><small>back</small></div> -->
<!-- if-have-clustered-results-head-end@ -->

<a id="search_home" title="Home (ctrl+h)" href="@base-url@/websearch-hp/">&nbsp;</a>

<div id="search_sugg"></div>

<div id="search_bar_tab">
<a class="search_bar_tab" href="http://www.seeks-project.info/wiki/index.php/Tips_%26_Troubleshooting#I_don.27t_get_search_results_in_the_language_I_want">Lang:</a> <span id="tab-language"></span>
<!-- <a class="search_bar_tab" href="@base-url@/search?q=fullquery&amp;page=xxpage&amp;expansion=xxexp&amp;action=expand&amp;engines=xxeng&amp;rpp=xxrpp&amp;content_analysis=xxca&amp;prs=xxnpers" title="Toggle personalization xxnpers">Pers:</a> <span id="tab-pers"></span> -->

<a id="tab-pers" class="search_bar_tab" href="javascript:void(null);" title="Toggle personalization">Pers:</a><span id="tab-pers-flag"></span>

<a class="search_bar_tab" href="http://www.seeks-project.info/wiki/index.php/User-Manual_Seeks_Bubs-0.2-SOLO" target="_blank" title="Help">Help</a>

<!-- <a id="tab-text" class="search_bar_tab" href="@base-url@/search?q=fullquery&amp;page=xxpage&amp;expansion=1&amp;action=expand&amp;prs=xxpers&amp;content_analysis=xxca" title="Search text">Text</a> -->
<a id="tab-text" class="search_bar_tab" title="Search text">Text</a>
<!-- @if-have-img-websearch-start -->
<!-- <a class="search_bar_tab" href="@base-url@/search_img?q=fullquery&amp;page=xxpage&amp;expansion=1&amp;action=expand&amp;prs=xxpers" title="Search images">Images</a> -->
<a id="tab-img" class="search_bar_tab" href="javascript:void(null);" title="Search images">Images</a>
<!-- if-have-img-websearch-end@ -->
<!-- <a class="search_bar_tab" href="@base-url@/search?q=fullquery&amp;page=xxpage&amp;expansion=1&amp;action=expand&amp;engines=youtube,dailymotion&amp;rpp=40&content_analysis=off&amp;prs=xxpers" title="Search videos">Videos</a> -->
<a id="tab-vid" class="search_bar_tab" href="javascript:void(null);" title="Search videos">Videos</a>
<!-- <a class="search_bar_tab" href="@base-url@/search?q=fullquery&amp;page=xxpage&amp;expansion=1&amp;action=expand&amp;engines=twitter,identica&amp;rpp=xxrpp&content_analysis=on&amp;prs=xxpers" title="Search tweets">Tweets</a> -->
<a id="tab-tweet" class="search_bar_tab" href="javascript:void(null);" title="Search tweets">Tweets</a>
<span class="search_bar_tab">Group by:</span> 
<!-- <a href="@base-url@/search?q=fullquery&amp;page=xxpage&amp;expansion=xxexp&amp;action=urls&amp;engines=xxeng&amp;rpp=xxrpp&amp;content_analysis=xxca&amp;prs=xxpers" title="Group by urls">urls</a>, -->
<a id="tab-urls" href="javascript:void(null);" title="Group by urls">urls</a>
<!-- <a href="@base-url@/search?q=fullquery&amp;page=xxpage&amp;expansion=xxexp&amp;action=titles&amp;engines=xxeng&amp;rpp=xxrpp&amp;content_analysis=xxca&amp;prs=xxpers" title="Group by titles">titles</a>, -->
<a id="tab-titles" href="javascript:void(null);" title="Group by titles">titles</a>
<!-- <a href="@base-url@/search?q=fullquery&amp;expansion=xxexp&amp;action=types&amp;engines=xxeng&amp;rpp=xxrpp&amp;content_analysis=xxca&amp;prs=xxpers" title="Group by types">types</a> -->
<a id="tab-types" href="javascript:void(null);" title="Group by type">types</a>
</div>

</div>


<table>
<tr>
<td>


<div id="main">
<div id="search_results">
<ol id="snippets">
</ol>
</div>

<!-- @if-websearch-have-js-start -->
<script type="text/javascript" src="@base-url@/public/yui/3.2.0/yui/yui-min.js"></script>
<!-- <script type="text/javascript" src="http://yui.yahooapis.com/3.2.0/build/yui/yui-min.js"></script> -->
<script type="text/javascript">

YUI().use("jsonp", "substitute", "transition", "querystring", function (Y) {

    // page information.
    function page_info()
    {    
	this.rpp = xxrpp;  // results per page.
	this.cpage = 1;  // current page.
	this.engines = '';
	this.expansion = 1;
	this.prs = "xxpers";
	this.ca = "xxca"; // content analysis.
    }
    var pi = new page_info();

    var ref_url = "@base-url@/search?q=fullquery&expansion=1&action=expand&rpp=10&content_analysis=off&prs=on&output=json&callback={callback}";
    
    var outputDiv = Y.one("#snippets"), expansionLnk = Y.one("#expand"), suggDiv = Y.one("#search_sugg"),
    pagesDiv = Y.one("#search_pages"), langSpan = Y.one("#tab-language"), persHref = Y.one("#tab-pers"),
    persSpan = Y.one("#tab-pers-flag"), textHref = Y.one("#tab-text"),
    vidHref = Y.one("#tab-video"), tweetHref = Y.one("#tab-tweet"),
    urlHref = Y.one("#tab-urls"), titleHref = Y.one("#tab-titles"), typeHref = Y.one("#tab-types"),
    queryInput = Y.one("#search_input");
    
    // result widget.
    function refresh(url)
    {
	outputDiv.setContent("Seeking...");
	
	var resultsWidget = new Y.JSONPRequest(url, {
        on: {
            success: function (response) {
		response.enc_query = ':' + response.lang + '+' + encodeURIComponent(response.query);
		var snippets_html = '';
                var l = response.snippets.length;
		
		//TODO: test whether JSON clusters field exists ...
		/* var cl = response.clusters.length;
		   var clustering = false;
		if (l == 0 & cl > 0)
		    clustering = true; */ // render in clustering mode.
		
		//TODO: clustering mode...

		for (i=0; i < l; ++i)
		{
		    var snippet = response.snippets[i];
                    
		    // personalization & title head.
		    if (snippet.personalized == 'yes')
		    {
			snippet.headHTML = '<h3 class=\"personalized_result personalized\" title=\"personalized result\">';
		    }
		    else
		    {
			snippet.headHTML = '<h3>';
		    }
		    
		    // render engines.
                    snippet.enginesHTML = '';
		    for (j=0, le=snippet.engines.length; j < le; ++j)
		    {
			snippet.enginesHTML += '<span class=\"search_engine search_engine_' + snippet.engines[j]  + '\" title=\"' + snippet.engines[j] + '\"><a href=\"';
			snippet.enginesHTML += '@base-url@/search?q=' + response.enc_query;
			snippet.enginesHTML += '&page=1&expansion=1&action=expand&engines=' + snippet.engines[j] + '\">';
			snippet.enginesHTML += '&nbsp;</a></span>';
		    }
		    
		    // Format the snippet info and store as a property of the
                    // snippet object for use by Y.substitute
                    // ('this' refers to the JSONPRequest object by default)
		    snippet.enc_query = response.enc_query;
		    snippet.snippetHTML = Y.substitute(this.snippetTemplate, snippet);
		    snippets_html += Y.substitute(this.resultTemplate, snippet);
		}
		outputDiv.setContent(snippets_html);
	    
		// expansion.
		pi.expansion = response.expansion;
		
		// personalization.
		pi.prs = response.pers;

		// engines.
		pi.engines = response.engines;

		// compute page number.
		var ns = response.snippets.length;
		var max_page = 1;
		if (ns > 0)
		    max_page = pi.rpp / ns;
		pi.ppage = pi.cpage - 1;
		pi.npage = pi.cpage + 1;
		if (pi.cpage > 1)
		{
		    pi.prev = '<a href=\"' + @base-url@ + '/search?page=' + pi.ppage + '&q='
			+ response.enc_query + '&expansion' + response.expansion + '&action=page&engines=' + pi.engines
			+ '&rpp=' + pi.rpp + '&content_analysis=off&prs=on \" id=\"search_page_prev\" title=\"Previous (ctrl+&lt)\">&nbsp;</a>';
		}
		else pi.prev = "";
		if (pi.cpage < max_page)
		{
		    pi.next = '<a href=\"' + @base-url@ + '/search?page=' + pi.npage + '&q='
			+ response.enc_query + '&expansion' + response.expansion + '&action=page&engines=' + pi.engines
                        + '&rpp=' + pi.rpp + '&content_analysis=off&prs=on \" id=\"search_page_next\" title=\"Next (ctrl+&gt)\">&nbsp;</a>';
		}
		else pi.next = "";
		pagesHTML = Y.substitute(pagesTemplate,pi);
		pagesDiv.setContent(pagesHTML);
		
		// render first shot search bar, then update it later on with JSON info.                                                              
                response.nexpn = eval(response.expansion) + 1;
		response.cpage = pi.cpage; // XXX: can't find how to pass either two objects, or embed object pi into response and still substitute...
                response.rpp = pi.rpp; // XXX: idem...
		var expansionHtml = Y.substitute(expansionTemplate, response);
                expansionLnk.setContent(expansionHtml);
		
		// personalization.
		/* var persHTML = Y.substitute(persTemplate, response);
		persHref.set('href',persHTML); */
		var persHTMLf = Y.substitute(persTemplateFlag, pi);
		persSpan.setContent(persHTMLf);

		//TODO: content analysis...

		// render language.
		var langHTML = Y.substitute(langTemplate, response);
		langSpan.setContent(langHTML);

		// query suggestion.
		suggDiv.setContent(response.suggestion);
	    },
	    
	    failure: function () {
                alert("fail");
                outputDiv.setContent(this.failureTemplate);
	    }
        }
    });
        
	/* main result widget stuff. */
    resultsWidget.resultTemplate =
        '<li class="search_snippet">{snippetHTML}</li>';
 
    resultsWidget.snippetTemplate =
        '{headHTML}<a href="{url}">{title}</a>{enginesHTML}</h3>' +
	'<div>{summary}</div>' +
	'<div><cite>{cite}</cite>' +
	'<a class="search_cache" href="{cached}">Cached</a><a class="search_cache" href="{archive}">Archive</a><a class="search_cache" href="/search?q={enc_query}&amp;page=1&amp;expansion=1&amp;action=similarity&amp;id={id}&amp;engines=">Similar</a></div>'; //TODO: expansion.
 
    resultsWidget.failureTemplate =
        '<p class="error">Ack, I couldn\'t reach the Seeks search service!</p>';
	
	resultsWidget.send();
    }
    
    /* send the request. */
    refresh(ref_url);
 
    /* expansion button rendering. */
    expansionTemplate = 
	'<a href="@base-url@/search?q={enc_query}&page={cpage}&expansion={nexpn}&action=expand&engines={engines}&rpp={rpp}&content_analysis=xxca&prs={pers}&ui=dyn&output=json" title="Expand to {nexpn} (ctrl+e). Deeper search." id="expansion" class="expansion_{expansion}">{expansion}</a>';

    /* prev / next page rendering. */
    pagesTemplate = 
	'{prev}<span id="search_page_current">{cpage}</span>{next}<small>page</small>';
    
    /* language rendering. */
    langTemplate = '{lang}';
    
    /* personalization rendering. */
    persTemplateFlag = '{prs}';
    
    // Click the search button to send the JSONP request
    Y.one("#search_form").on("submit", function (e) {
	var url = '@base-url@/search?' + Y.QueryString.stringify({"q":queryInput.get('value'),"expansion":1,"action":"expand","rpp":pi.rpp,"prs":"on","content_analysis":pi.ca,"ui":"dyn","output":"json"}) + "engines=" + pi.engines + "&callback={callback}";
	refresh(url);
	return false;
    });
    
    Y.one("#tab-pers").on("click",function(e) {
	var nprs = "off";
	if (pi.prs == "off")
	    nprs = "on";
	var url = '@base-url@/search?' + Y.QueryString.stringify({"q":queryInput.get('value'),"expansion":pi.expansion,"action":"expand","rpp":pi.rpp,"prs":nprs,"content_analysis":pi.ca,"ui":"dyn","output":"json"}) + "engines=" + pi.engines + "&callback={callback}";
	refresh(url);
	return false;
    });
    
    Y.one("#tab-img").on("click",function(e) {
	var url = '@base-url@/search_img?' + Y.QueryString.stringify({"q":queryInput.get('value'),"expansion":1,"action":"expand","rpp":pi.rpp,"prs":"on","content_analysis":pi.ca,"ui":"dyn","output":"json"}) + "&callback={callback}";
	refresh(url);
	return false;
    });

    Y.one("#tab-vid").on("click",function(e) {
	var url = '@base-url@/search?' + Y.QueryString.stringify({"q":queryInput.get('value'),"expansion":1,"action":"expand","rpp":40,"prs":"on","content_analysis":pi.ca,"ui":"dyn","output":"json"}) + "&engines=youtube,dailymotion&callback={callback}";
	refresh(url);
	return false;
    });

    Y.one("#tab-tweet").on("click",function(e) {
	var url = '@base-url@/search?' + Y.QueryString.stringify({"q":queryInput.get('value'),"expansion":1,"action":"expand","rpp":40,"prs":"on","content_analysis":pi.ca,"ui":"dyn","output":"json"}) + "&engines=twitter,identica&callback={callback}";
	refresh(url);
	return false;
    });

    Y.one("#tab-urls").on("click",function(e) {
	var url = '@base-url@/search?' + Y.QueryString.stringify({"q":queryInput.get('value'),"expansion":pi.expansion,"action":"urls","rpp":pi.rpp,"prs":pi.pers,"content_analysis":pi.ca,"ui":"dyn","output":"json"}) + "&engines=" + pi.engines + "&callback={callback}";
	refresh(url);
	return false;
    });
    
    Y.one("#tab-titles").on("click",function(e) {
        var url = '@base-url@/search?' + Y.QueryString.stringify({"q":queryInput.get('value'),"expansion":pi.expansion,"action":"titles","rpp":pi.rpp,"prs":pi.pers,"content_analysis":pi.ca,"ui":"dyn","output":"json"}) + "&engines=" + pi.engines + "&callback={callback}";
	refresh(url);
	return false;
    });

    Y.one("#tab-types").on("click",function(e) {
        var url = '@base-url@/search?' + Y.QueryString.stringify({"q":queryInput.get('value'),"expansion":pi.expansion,"action":"types","rpp":pi.rpp,"prs":pi.pers,"content_analysis":pi.ca,"ui":"dyn","output":"json"}) + "&engines=" + pi.engines + "&callback={callback}";
	refresh(url);
	return false;
    });
});
 

// Shortcut for search, ctrl+s
YUI().use('event-key', function(Y) {
    var handle = Y.on('key', function(e) {
        e.halt();
        Y.one('#search_input').select();
    }, document, 'press:102+ctrl');

});

// Shortcut for expansion, ctrl+e
YUI().use('event-key', function(Y) {
    var handle = Y.on('key', function(e) {
        e.halt();
        document.location = Y.one('#expansion').getAttribute('href');
    }, document, 'press:101+ctrl');

});

// Shortcut for clustering, ctrl+c
YUI().use('event-key', function(Y) {
    var handle = Y.on('key', function(e) {
    e.halt();
    document.location = Y.one('#cluster').getAttribute('href');
    }, document, 'press:99+ctrl');


});


// Shortcut for previous page, ctrl+<
YUI().use('event-key', function(Y) { 
    var handle = Y.on('key', function(e) {
        e.halt();                    
        document.location = Y.one('#search_page_prev').getAttribute('href');
    }, document, 'press:37+ctrl');

});

// Shortcut for previous page, ctrl+>
YUI().use('event-key', function(Y) {
    var handle = Y.on('key', function(e) {
        e.halt();
        document.location = Y.one('#search_page_next').getAttribute('href');
    }, document, 'press:39+ctrl');

});

// Shortcut for home page, ctrl+h
YUI().use('event-key', function(Y) {
    var handle = Y.on('key', function(e) {
        e.halt();
        document.location = Y.one('#search_home').getAttribute('href');
    }, document, 'press:104+ctrl');

});

</script>
<!-- if-websearch-have-js-end@ -->

</div> 
</td>

<td style="vertical-align:top;">
<!-- message panel -->
<!-- @if-have-result-message-start -->
<div id="message">
<p>xxmsg</p>
<!-- img src="public/images/seek_icon_32x32_transparent.png"/> -->
</div>
<!-- if-have-result-message-end@ -->
</td>
</tr>
</table>

</body></html>
